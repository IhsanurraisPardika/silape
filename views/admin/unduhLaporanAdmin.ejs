<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unduh Laporan</title>
  <link rel="icon" href="/images/sp.png" type="image/sp.png">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 antialiased">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <%- include('../partials/sidebarAdmin') %>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Header -->
      <%- include('../partials/header') %>

      <!-- Main Content -->
      <main class="flex-1 overflow-auto bg-gray-50">
        <div class="p-8 pb-24">
          <h1 class="text-3xl font-bold text-gray-800 mb-6">Unduh Laporan</h1>

          <!-- Card Form -->
          <div class="bg-white rounded-lg shadow p-6 max-w-3xl">
            <!-- Periode -->
            <div class="mb-5">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Periode
              </label>
              <select id="periodeSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                <% periodes.forEach(p => { %>
                  <option value="<%= p.id %>" <%= p.statusAktif ? 'selected' : '' %>><%= p.namaPeriode %></option>
                <% }) %>
              </select>
            </div>

            <!-- Tim -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Tim
              </label>
              <select id="timSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
                <option value="all">Semua tim</option>
                <% teams.forEach(t => { %>
                  <option value="<%= t.email %>"><%= t.timKode || t.nama || t.email %></option>
                <% }) %>
              </select>
            </div>

            <!-- Button Download Excel -->
            <button id="downloadBtn" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-medium px-6 py-3 rounded-lg transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4" />
              </svg>
              Download Excel
            </button>
          </div>
        </div>
      </main>

      <script>
        document.getElementById('downloadBtn').addEventListener('click', function() {
          const periodeId = document.getElementById('periodeSelect').value;
          const timEmail = document.getElementById('timSelect').value;
          
          let url = `/dashboardAdmin/downloadRekapPenilaian?periodeId=${periodeId}`;
          if (timEmail !== 'all') {
            url += `&timEmail=${encodeURIComponent(timEmail)}`;
          }
          
          window.location.href = url;
        });
      </script>
      <div class="mt-auto">
          <%- include('../partials/footer') %>
        </div>
    </div>
  </div>
</body>
</html>